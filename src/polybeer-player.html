<link rel="import" href="../bower_components/polymer/polymer.html">
<script src="../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
<link rel="import" href="../bower_components/voice-elements/dist/voice-player.html">
<!-- <link rel="import" href="../bower_components/voice-elements/dist/voice-recognition.html"> -->

<dom-module id="polybeer-player">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <voice-player></voice-player>

    </template>

    <script>
        Polymer({
            is: 'polybeer-player',
            properties: {
                autoplay: {
                    type: Boolean,
                    value: false
                },
                accent: {
                    type: String,
                    value: 'en-US',
                    observer: '_accentChanged',
                    notify: true
                },
                text: {
                    type: String,
                    value: 'value',
                    observer: '_textChanged',
                    notify: true
                }
            },
            created: function() {
                if ('speechSynthesis' in window) {
                    this.speech = new SpeechSynthesisUtterance();
                }
                else {
                    console.error('Your browser does not support the Web Speech API');
                }
            },
            ready: function() {
                // Initialize attributes
                this._textChanged();
                this._accentChanged();

                // Initialize event listeners
                var events = ['start', 'end', 'error', 'pause', 'resume'];
                events.forEach(this._propagateEvent.bind(this));

                if (this.autoplay) {
                    this.speak();
                }
            },
            _accentChanged: function() {
                this.speech.lang = this.accent;
            },
            _textChanged: function() {
                this.speech.text = this.text;
            },
            _propagateEvent: function (eventName) {
                var that = this;

                this.speech.addEventListener(eventName, function(e) {
                    that.fire(eventName, e);
                });
            },
            speak: function() {
                window.speechSynthesis.speak(this.speech);
            },
            cancel: function() {
                window.speechSynthesis.cancel();
            },
            pause: function() {
                window.speechSynthesis.pause();
            },
            resume: function() {
                window.speechSynthesis.resume();
            }
        });
    </script>
</dom-module>
